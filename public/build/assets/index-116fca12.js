var _=function(){var u,b,p,h,c;const S=APP_URL+"/api/shelves",x=APP_URL+"/api/shelves",w=APP_URL+"/api/shelves/update",k=APP_URL+"/api/shelves/delete",v=APP_URL+"/api/export",T=()=>{var r,i,t,o;const a=document.querySelector("#kt_modal_filter");var n=document.querySelector(".search-input"),s=document.querySelector('[data-kt-table-filter="search-loader"]');a&&(r=new bootstrap.Modal(a),i=$("#kt_modal_filter_form"),t=a.querySelector('[data-kt-table-filter="reload"]'),o=a.querySelector('[data-kt-table-filter="reset"]')),c=$(u).DataTable({info:!0,processing:!0,serverSide:!0,order:[],pageLength:50,columnDefs:[{orderable:!1,targets:[0]},{orderable:!1,targets:4,visible:permissions.modUpdate==1||permissions.modDelete==1}],ajax:{url:S,method:"GET",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"},error:function(e,l,d){Swal.fire({title:"Request Timeout",text:"Oops :( request timed out. This could be as a result of an internal server error or slow or no internet connection. In the meantime, you can check your internet connection, refresh the page or wait a few minutes. Please contact admin if it persists.",icon:"info",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})},data:function(e){return"modAction=modRead&modID="+permissions.modID+"&dt_start="+e.start+"&dt_length="+e.length+"&dt_draw="+e.draw+"&dt_search="+n.value+(i?"&"+i.serialize():"")},beforeSend:function(){t&&(t.setAttribute("data-kt-indicator","on"),t.disabled=!0),s&&(s.setAttribute("data-kt-indicator","on"),s.disabled=!0)},complete:function(){t&&(t.removeAttribute("data-kt-indicator"),t.disabled=!1,r.hide()),s&&(s.removeAttribute("data-kt-indicator","on"),s.disabled=!1)}},columns:[{className:"p-4",defaultContent:`<div class="form-check form-check-sm form-check-custom">
                                    <input class="form-check-input" type="checkbox" value="1" />
                                </div>`},{data:"name"},{data:"dateCreated"},{data:null,className:"text-center",render:function(e,l,d,m){let f="";return e.status=="ACTIVE"?f='<div class="bg-success fw-bolder p-2 text-white">Active</div>':e.status=="INACTIVE"&&(f='<div class="bg-warning fw-bolder p-2 text-white">Inactive</div>'),f}},{data:null,className:"text-center text-nowrap",render:function(e,l,d,m){var f="";return permissions.modUpdate==1&&(f+=`<span style="cursor:pointer" class="text-info me-3" data-kt-table-filter="update_row">
                                        Edit
                                    </span>`),permissions.modDelete==1&&(f+=`<span style="cursor:pointer" class="text-danger me-3 delete-btn" data-action="delete" data-id="${e.id}" data-kt-table-filter="delete">
                                        Delete
                                    </span>`),f}}],buttons:[{extend:"print",exportOptions:{columns:[1,2,3]}},{extend:"copy",exportOptions:{columns:[1,2,3]}},{extend:"excel",exportOptions:{columns:[1,2,3]}},{extend:"csv",exportOptions:{columns:[1,2,3]}},{extend:"pdf",exportOptions:{columns:[1,2,3]}},{text:"Refresh",action:function(e,l,d,m){l.ajax.reload(!1,null)}}]}),c.on("draw",function(){y(),E(),O(),g()}),n&&n.addEventListener("keyup",function(){c.search(n.value).draw()}),i&&(t&&t.addEventListener("click",function(e){c.ajax.reload()}),o&&o.addEventListener("click",function(){const e=document.querySelector('[data-kt-table-filter="form"]');e.querySelectorAll("select").forEach(d=>{$(d).val("").trigger("change")}),e.reset(),c.ajax.reload()}))},B=async()=>{if(permissions.modCreate==0)return;const r=document.querySelector("#kt_modal_add_common");if(!r)return;const i=new bootstrap.Modal(r),t=r.querySelector("form");if(!t)return;const o=r.querySelector('[data-action="submit"]');if(!o)return;const a=t.querySelectorAll("select");o.addEventListener("click",async n=>{n.preventDefault(),o.setAttribute("data-kt-indicator","on"),o.disabled=!0;let s=new FormData(t);s.append("modAction","modCreate"),s.append("modID",permissions.modID);try{const e=await fetch(x,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:s}),{ok:l,msg:d}=await e.json();if(!l){Swal.fire({text:d,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}t.reset(),i.hide(),c.ajax.reload(),a.forEach(m=>$(m).val("").trigger("change")),Swal.fire({text:d,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}catch(e){Swal.fire({text:e.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{o.removeAttribute("data-kt-indicator"),o.disabled=!1}})},A=async()=>{if(permissions.modUpdate==0)return;const r=document.querySelector("#kt_modal_update_common");if(!r)return;const i=new bootstrap.Modal(r),t=r.querySelector("form");if(!t)return;const o=r.querySelector('[data-action="submit"]');if(!o)return;const a=t.querySelectorAll("select");o.addEventListener("click",async n=>{n.preventDefault(),o.setAttribute("data-kt-indicator","on"),o.disabled=!0;let s=new FormData(t);s.append("modAction","modUpdate"),s.append("modID",permissions.modID);try{const e=await fetch(w,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:s}),{ok:l,msg:d}=await e.json();if(!l){Swal.fire({text:d,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}t.reset(),i.hide(),c.ajax.reload(),a.forEach(m=>$(m).val("").trigger("change")),Swal.fire({text:d,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}catch(e){Swal.fire({text:e.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{o.removeAttribute("data-kt-indicator"),o.disabled=!1}})},O=()=>{if(permissions.modUpdate==0)return;u.querySelectorAll('[data-kt-table-filter="update_row"]').forEach(i=>{i.addEventListener("click",function(t){t.preventDefault();const o=c.row($(t.target.closest("tbody tr"))).data();$("#kt_modal_update_common").modal("show"),$("#update-code").val(o.id),$("#update-name").val(o.name),$("#update-status").val(o.status).trigger("change")})})},C=function(){if(permissions.modReport==0)return;const r=document.getElementById("kt_modal_export");if(!r)return;const i=r.querySelector("#kt_modal_export_form"),t=new bootstrap.Modal(r);var o=FormValidation.formValidation(i,{fields:{format:{validators:{notEmpty:{message:"File format is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});const a=r.querySelector('[data-kt-modal-action="submit"]');a.addEventListener("click",function(n){n.preventDefault(),o&&o.validate().then(function(s){if(s=="Valid"){a.setAttribute("data-kt-indicator","on");var e=document.getElementById("export-format").value;a.setAttribute("data-kt-indicator","on"),a.disabled=!0,fetch(v+"?modAction=modReport&modID="+permissions.modID,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"}}).then(function(l){return l.json()}).then(function(l){if(!l.ok){a.removeAttribute("data-kt-indicator"),a.disabled=!1,Swal.fire({text:l.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}a.removeAttribute("data-kt-indicator"),a.disabled=!1,t.hide(),Swal.fire({text:"Data is ready to be exported!",icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, Export!",customClass:{confirmButton:"btn btn-primary"}}).then(function(d){e==="print"?c.button(".buttons-print").trigger():e==="excel"?c.button(".buttons-excel").trigger():e==="csv"?c.button(".buttons-csv").trigger():e==="pdf"&&c.button(".buttons-pdf").trigger()})}).catch(function(l){l&&(a.removeAttribute("data-kt-indicator"),a.disabled=!1,Swal.fire({text:l,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}))})}else Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})})},E=async()=>{if(permissions.modDelete==0)return;u.querySelectorAll('[data-action="delete"]').forEach(i=>{i.addEventListener("click",async t=>{t.preventDefault();let o=JSON.stringify([t.currentTarget.getAttribute("data-id")]);Swal.fire({title:"Are you sure?",text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(async a=>{if(a.value){Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1});try{const n=await fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+o,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}),{ok:s,msg:e}=await n.json();if(!s){Swal.fire({text:e,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:e,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(l=>{c.ajax.reload()})}catch(n){Swal.fire({text:n.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{}}else a.dismiss==="cancel"&&Swal.fire({text:"Record was not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})})},y=()=>{if(permissions.modDelete==0)return;const r=u.querySelectorAll('[type="checkbox"]');b=document.querySelector('[data-kt-table-toolbar="base"]'),p=document.querySelector('[data-kt-table-toolbar="selected"]'),h=document.querySelector('[data-kt-table-select="selected_count"]');const i=document.querySelector('[data-kt-table-select="delete_selected"]');r.forEach(t=>{t.addEventListener("click",function(){setTimeout(function(){g()},50)})}),i.addEventListener("click",function(){Swal.fire({text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(t){if(t.value){var o=[];r.forEach(n=>{var e=n.closest("tr").querySelector(".delete-btn");e&&n.checked&&o.push(e.getAttribute("data-id"))});var a=JSON.stringify(o);Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+a,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(n){return n.json()}).then(function(n){if(!n.ok){Swal.fire({text:n.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:"Record(s) deleted!.",icon:"success",buttonsStyling:!1,allowOutsideClick:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}}).then(function(){c.ajax.reload(),u.querySelectorAll('[type="checkbox"]')[0].checked=!1}).then(function(){g(),y()})}).catch(function(n){n&&Swal.fire({text:n,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})}else t.dismiss==="cancel"&&Swal.fire({text:"Selected record(s) not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})},g=()=>{const r=u.querySelectorAll('tbody [type="checkbox"]');let i=!1,t=0;r.forEach(o=>{o.checked&&(i=!0,t++)}),i?(h.innerHTML=t,b&&b.classList.add("d-none"),p&&p.classList.remove("d-none")):(b&&b.classList.remove("d-none"),p&&p.classList.add("d-none"))};return{init:function(){u=document.getElementById("kt_table_common"),u&&permissions.modRead!=0&&(T(),y(),C(),B(),A())}}}();KTUtil.onDOMContentLoaded(function(){_.init()});
