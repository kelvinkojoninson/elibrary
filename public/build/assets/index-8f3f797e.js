var A=function(){var f,m,b,h,c;const x=APP_URL+"/api/books",k=APP_URL+"/api/probooksducts/delete",v=APP_URL+"/api/export",S=()=>{var a,i,e,r;const o=document.querySelector("#kt_modal_filter");var n=document.querySelector(".search-input"),l=document.querySelector('[data-kt-table-filter="search-loader"]');o&&(a=new bootstrap.Modal(o),i=$("#kt_modal_filter_form"),e=o.querySelector('[data-kt-table-filter="reload"]'),r=o.querySelector('[data-kt-table-filter="reset"]')),c=$(f).DataTable({info:!0,processing:!0,serverSide:!0,order:[],pageLength:50,columnDefs:[{orderable:!1,targets:[0]},{orderable:!1,targets:15,visible:permissions.modUpdate==1||permissions.modDelete==1}],ajax:{url:x,method:"GET",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"},error:function(t,s,u){Swal.fire({title:"Request Timeout",text:"Oops :( request timed out. This could be as a result of an internal server error or slow or no internet connection. In the meantime, you can check your internet connection, refresh the page or wait a few minutes. Please contact admin if it persists.",icon:"info",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})},data:function(t){return"modAction=modRead&modID="+permissions.modID+"&dt_start="+t.start+"&dt_length="+t.length+"&dt_draw="+t.draw+"&dt_search="+n.value+(i?"&"+i.serialize():"")},beforeSend:function(){e&&(e.setAttribute("data-kt-indicator","on"),e.disabled=!0),l&&(l.setAttribute("data-kt-indicator","on"),l.disabled=!0)},complete:function(){e&&(e.removeAttribute("data-kt-indicator"),e.disabled=!1,a.hide()),l&&(l.removeAttribute("data-kt-indicator","on"),l.disabled=!1)}},columns:[{className:"p-4",defaultContent:`<div class="form-check form-check-sm form-check-custom">
                                    <input class="form-check-input" type="checkbox" value="1" />
                                </div>`},{data:null,render:function(t,s,u,p){return`<a href="${APP_URL}/book/${t.id}" class="text-gray-800 me-3">
                                   <u>${t.bookId}</u>
                               </a>`}},{data:null,render:function(t,s,u,p){return`<a href="${APP_URL}/book/${t.id}" class="text-gray-800 me-3">
                                   <u>${t.title}</u>
                               </a>`}},{data:"author"},{data:"categoryName"},{data:"genres"},{data:"publicationYear"},{data:"pages"},{data:"isEbook",render:function(t,s,u,p){let d="";return t=="YES"?d='<div class="bg-success fw-bolder p-2 text-white">Yes</div>':t=="NO"&&(d='<div class="bg-warning fw-bolder p-2 text-white">No</div>'),d}},{data:"ebookFormat"},{data:"shelfName"},{data:"callNumber"},{data:"condition"},{data:null,className:"text-center",render:function(t,s,u,p){let d="";return t.status=="ACTIVE"?d='<div class="bg-success fw-bolder p-2 text-white">Active</div>':t.status=="INACTIVE"&&(d='<div class="bg-warning fw-bolder p-2 text-white">Inactive</div>'),d}},{data:"dateCreated"},{data:null,className:"text-center text-nowrap",render:function(t,s,u,p){var d="";return permissions.modUpdate==1&&(d+=`<a href="${APP_URL+"/book/"+t.id}" class="btn btn-icon btn-info me-3">
                                             <i class="ki-outline ki-eye fs-1"></i>
                                        </a>`),permissions.modDelete==1&&(d+=`<button type="button" class="btn btn-icon btn-danger delete-btn me-3" data-action="delete" data-id="${t.id}" data-kt-table-filter="delete">
                                            <i class="ki-outline ki-eye fs-1"></i>
                                        </button>`),d}}],buttons:[{extend:"print",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}},{extend:"copy",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}},{extend:"excel",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}},{extend:"csv",exportOptions:{columns:[2,3,4,5,6,7,8,9,10]}},{extend:"pdf",exportOptions:{columns:[1,2,3,4,5,6,7,8,9,10,11,12,13,14]}},{text:"Refresh",action:function(t,s,u,p){s.ajax.reload(!1,null)}}]}),c.on("draw",function(){y(),T(),g()}),n&&n.addEventListener("keyup",function(){c.search(n.value).draw()}),i&&(e&&e.addEventListener("click",function(t){c.ajax.reload()}),r&&r.addEventListener("click",function(){const t=document.querySelector('[data-kt-table-filter="form"]');t.querySelectorAll("select").forEach(u=>{$(u).val("").trigger("change")}),t.reset(),c.ajax.reload()}))},w=function(){if(permissions.modReport==0)return;const a=document.getElementById("kt_modal_export");if(!a)return;const i=a.querySelector("#kt_modal_export_form"),e=new bootstrap.Modal(a);var r=FormValidation.formValidation(i,{fields:{format:{validators:{notEmpty:{message:"File format is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});const o=a.querySelector('[data-kt-modal-action="submit"]');o.addEventListener("click",function(n){n.preventDefault(),r&&r.validate().then(function(l){if(l=="Valid"){o.setAttribute("data-kt-indicator","on");var t=document.getElementById("export-format").value;o.setAttribute("data-kt-indicator","on"),o.disabled=!0,fetch(v+"?modAction=modReport&modID="+permissions.modID,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"}}).then(function(s){return s.json()}).then(function(s){if(!s.ok){o.removeAttribute("data-kt-indicator"),o.disabled=!1,Swal.fire({text:s.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}o.removeAttribute("data-kt-indicator"),o.disabled=!1,e.hide(),Swal.fire({text:"Data is ready to be exported!",icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, Export!",customClass:{confirmButton:"btn btn-primary"}}).then(function(u){t==="print"?c.button(".buttons-print").trigger():t==="excel"?c.button(".buttons-excel").trigger():t==="csv"?c.button(".buttons-csv").trigger():t==="pdf"&&c.button(".buttons-pdf").trigger()})}).catch(function(s){s&&(o.removeAttribute("data-kt-indicator"),o.disabled=!1,Swal.fire({text:s,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}))})}else Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})})},T=async()=>{if(permissions.modDelete==0)return;f.querySelectorAll('[data-action="delete"]').forEach(i=>{i.addEventListener("click",async e=>{e.preventDefault();let r=JSON.stringify([e.currentTarget.getAttribute("data-id")]);Swal.fire({title:"Are you sure?",text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(async o=>{if(o.value){Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1});try{const n=await fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+r,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}),{ok:l,msg:t}=await n.json();if(!l){Swal.fire({text:t,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:t,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(s=>{c.ajax.reload()})}catch(n){Swal.fire({text:n.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{}}else o.dismiss==="cancel"&&Swal.fire({text:"Record was not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})})},y=()=>{if(permissions.modDelete==0)return;const a=f.querySelectorAll('[type="checkbox"]');m=document.querySelector('[data-kt-table-toolbar="base"]'),b=document.querySelector('[data-kt-table-toolbar="selected"]'),h=document.querySelector('[data-kt-table-select="selected_count"]');const i=document.querySelector('[data-kt-table-select="delete_selected"]');a.forEach(e=>{e.addEventListener("click",function(){setTimeout(function(){g()},50)})}),i.addEventListener("click",function(){Swal.fire({text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(e){if(e.value){var r=[];a.forEach(n=>{var t=n.closest("tr").querySelector(".delete-btn");t&&n.checked&&r.push(t.getAttribute("data-id"))});var o=JSON.stringify(r);Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+o,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(n){return n.json()}).then(function(n){if(!n.ok){Swal.fire({text:n.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:"Record(s) deleted!.",icon:"success",buttonsStyling:!1,allowOutsideClick:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}}).then(function(){c.ajax.reload(),f.querySelectorAll('[type="checkbox"]')[0].checked=!1}).then(function(){g(),y()})}).catch(function(n){n&&Swal.fire({text:n,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})}else e.dismiss==="cancel"&&Swal.fire({text:"Selected record(s) not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})},g=()=>{const a=f.querySelectorAll('tbody [type="checkbox"]');let i=!1,e=0;a.forEach(r=>{r.checked&&(i=!0,e++)}),i?(h.innerHTML=e,m&&m.classList.add("d-none"),b&&b.classList.remove("d-none")):(m&&m.classList.remove("d-none"),b&&b.classList.add("d-none"))},B=(a,i)=>{const e=document.getElementById(a),r=document.getElementById(i);e.addEventListener("change",o=>{o.target.checked?r.classList.remove("d-none"):r.classList.add("d-none")})},E=function(a){let i=1,e=moment().year();var r=moment([e,i-1]),o=moment();function n(l,t){$(a).html(l.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"))}$(a).daterangepicker({startDate:r,endDate:o,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},n),n(r,o)};return{init:function(){f=document.getElementById("kt_table_common"),f&&permissions.modRead!=0&&(S(),y(),w(),B("date_checkbox","date_checkbox_form"),E("#filter_datepicker"))}}}();KTUtil.onDOMContentLoaded(function(){A.init()});
