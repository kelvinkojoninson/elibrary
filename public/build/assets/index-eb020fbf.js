var I=function(){var f,b,p,h,d;const S=APP_URL+"/api/users",x=APP_URL+"/api/users",v=APP_URL+"/api/users/update",k=APP_URL+"/api/users/delete",w=APP_URL+"/api/export",B=()=>{var r,s,o,e,a=document.querySelector(".search-input"),n=document.querySelector('[data-kt-table-filter="search-loader"]');const l=document.querySelector("#kt_modal_filter");l&&(r=new bootstrap.Modal(l),s=$("#kt_modal_filter_form"),o=l.querySelector('[data-kt-table-filter="reload"]'),e=l.querySelector('[data-kt-table-filter="reset"]')),d=$(f).DataTable({info:!0,processing:!0,serverSide:!0,order:[],pageLength:20,columnDefs:[{orderable:!1,targets:0},{orderable:!1,targets:10,visible:permissions.modUpdate==1||permissions.modDelete==1}],ajax:{url:S,method:"GET",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"},error:function(t,i,c){Swal.fire({title:"Request Timeout",text:"Oops :( request timed out. This could be as a result of an internal server error or slow or no internet connection. In the meantime, you can check your internet connection, refresh the page or wait a few minutes. Please contact admin if it persists.",icon:"info",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})},data:function(t){return"modAction=modRead&modID="+permissions.modID+"&dt_start="+t.start+"&dt_length="+t.length+"&dt_draw="+t.draw+"&dt_search="+a.value+(s?"&"+s.serialize():"")},beforeSend:function(){o&&(o.setAttribute("data-kt-indicator","on"),o.disabled=!0),n&&(n.setAttribute("data-kt-indicator","on"),n.disabled=!0)},complete:function(){o&&(o.removeAttribute("data-kt-indicator"),o.disabled=!1,r.hide()),n&&(n.removeAttribute("data-kt-indicator","on"),n.disabled=!1)}},columns:[{className:"p-4",defaultContent:`<div class="form-check form-check-sm form-check-custom">
                                    <input class="form-check-input" type="checkbox" value="1" />
                                </div>`},{data:null,render:function(t,i,c,m){return`
                    <div class="symbol symbol-70px me-3">
                        <div class="symbol-label">
                            <img src="${t.picture?t.picture:"/assets/images/user.png"}" alt="${t.name}" class="img-card w-100 h-100" />
                        </div>
                    </div>`}},{data:"userid"},{data:"name"},{data:"email",render:function(t,i,c,m){return`<a class="text-gray-700" href="mailto:${t}">${t}</a>`}},{data:"phone"},{data:null,className:"text-center",render:function(t,i,c,m){return`<div class="badge badge-${t.roleBadge}">${t.roleDesc}</div>`}},{data:"lastLogin"},{data:null,render:function(t,i,c,m){return`<div class="d-flex flex-column">
                            <span class="text-gray-800 mb-1">${t.dateCreated}</span>
                            <span class="text-gray-700 fs-7">${t.createdBy}</span>
                        </div>`}},{data:null,render:function(t,i,c,m){return`<div class="d-flex flex-column">
                            <span class="text-gray-800 mb-1">${t.dateUpdated}</span>
                            <span class="text-gray-800 fs-7">${t.updatedBy}</span>
                        </div>`}},{data:"status",className:"text-center",render:function(t,i,c,m){let u="";return t=="ACTIVE"?u+='<div class="bg-success">Active</div>':t=="INACTIVE"?u+='<div class="bg-warning">Inactive</div>':t=="SUSPENDED"&&(u+='<div class="bg-danger text-white">Suspended</div>'),u}},{data:null,className:"text-center text-nowrap",render:function(t,i,c,m){var u="";return permissions.modUpdate==1&&(u+=`<span style="cursor:pointer" class="text-primary me-3" data-kt-table-filter="update_row">
                                        Edit
                                    </span>`),permissions.modDelete==1&&(u+=`<span style="cursor:pointer" class="text-danger me-3 delete-btn" data-action="delete" data-id="${t.id}" data-kt-table-filter="delete">
                                        Delete
                                    </span>`),u}}],buttons:[{extend:"print",exportOptions:{columns:[1,2,3,4,5,6,7,8,9]}},{extend:"copy",exportOptions:{columns:[1,2,3,4,5,6,7,8,9]}},{extend:"excel",exportOptions:{columns:[1,2,3,4,5,6,7,8,9]}},{extend:"csv",exportOptions:{columns:[1,2,3,4,5,6,7,8,9]}},{extend:"pdf",exportOptions:{columns:[1,2,3,4,5,6,7,8,9]}},{text:"Refresh",action:function(t,i,c,m){i.ajax.reload(!1,null)}}]}),d.on("draw",function(){y(),C(),A(),g()}),a&&a.addEventListener("keyup",function(t){(t.key==="Enter"||t.keyCode===13)&&d.search(a.value).draw()}),s&&(o&&o.addEventListener("click",function(t){d.ajax.reload()}),e&&e.addEventListener("click",function(){const t=document.querySelector('[data-kt-table-filter="form"]');t.querySelectorAll("select").forEach(c=>{$(c).val("").trigger("change")}),t.reset(),d.ajax.reload()}))},T=async()=>{if(permissions.modCreate==0)return;const r=document.querySelector("#kt_modal_add_common");if(!r)return;const s=new bootstrap.Modal(r),o=r.querySelector("form");if(!o)return;const e=r.querySelector('[data-action="submit"]');if(!e)return;const a=o.querySelectorAll("select");e.addEventListener("click",async n=>{n.preventDefault(),e.setAttribute("data-kt-indicator","on"),e.disabled=!0;let l=new FormData(o);l.append("modAction","modCreate"),l.append("modID",permissions.modID);try{const t=await fetch(x,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:l}),{ok:i,msg:c}=await t.json();if(!i){Swal.fire({text:c,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:c,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(m=>{m.isConfirmed&&(o.reset(),s.hide(),d.ajax.reload(),a.forEach(u=>$(u).val("").trigger("change")))})}catch(t){Swal.fire({text:t.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{e.removeAttribute("data-kt-indicator"),e.disabled=!1}})},E=async()=>{if(permissions.modUpdate==0)return;const r=document.querySelector("#kt_modal_update_common");if(!r)return;const s=new bootstrap.Modal(r),o=r.querySelector("form");if(!o)return;const e=r.querySelector('[data-action="submit"]');if(!e)return;const a=o.querySelectorAll("select");e.addEventListener("click",async n=>{n.preventDefault(),e.setAttribute("data-kt-indicator","on"),e.disabled=!0;let l=new FormData(o);l.append("modAction","modUpdate"),l.append("modID",permissions.modID);try{const t=await fetch(v,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:l}),{ok:i,msg:c}=await t.json();if(!i){Swal.fire({text:c,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:c,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(m=>{m.isConfirmed&&(o.reset(),s.hide(),d.ajax.reload(),a.forEach(u=>$(u).val("").trigger("change")))})}catch(t){Swal.fire({text:t.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{e.removeAttribute("data-kt-indicator"),e.disabled=!1}})},A=()=>{if(permissions.modUpdate==0)return;f.querySelectorAll('[data-kt-table-filter="update_row"]').forEach(s=>{s.addEventListener("click",function(o){o.preventDefault();const e=d.row($(o.target.closest("tbody tr"))).data();$("#kt_modal_update_common").modal("show"),e.picture&&(document.getElementById("update-img-holder").style.backgroundImage="url("+e.picture+")"),document.getElementById("update-code").value=e.id,document.getElementById("update-name").value=e.name,document.getElementById("update-phone").value=e.phone,document.getElementById("update-email").value=e.email,$("#update-status").val(e.status).trigger("change"),$("#update-role").val(e.roleId).trigger("change")})})},C=async()=>{if(permissions.modDelete==0)return;f.querySelectorAll('[data-action="delete"]').forEach(s=>{s.addEventListener("click",async o=>{o.preventDefault();let e=JSON.stringify([o.currentTarget.getAttribute("data-id")]);Swal.fire({title:"Are you sure?",text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(async a=>{if(a.value){Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1});try{const n=await fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+e,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}),{ok:l,msg:t}=await n.json();if(!l){Swal.fire({text:t,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:t,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(i=>{d.ajax.reload()})}catch(n){Swal.fire({text:n.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{}}else a.dismiss==="cancel"&&Swal.fire({text:"Record was not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})})},y=()=>{if(permissions.modDelete==0)return;const r=f.querySelectorAll('[type="checkbox"]');b=document.querySelector('[data-kt-table-toolbar="base"]'),p=document.querySelector('[data-kt-table-toolbar="selected"]'),h=document.querySelector('[data-kt-table-select="selected_count"]');const s=document.querySelector('[data-kt-table-select="delete_selected"]');r.forEach(o=>{o.addEventListener("click",function(){setTimeout(function(){g()},50)})}),s.addEventListener("click",function(){Swal.fire({text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(o){if(o.value){var e=[];r.forEach(n=>{var t=n.closest("tr").querySelector(".delete-btn");t&&n.checked&&e.push(t.getAttribute("data-id"))});var a=JSON.stringify(e);Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+a,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(n){return n.json()}).then(function(n){if(!n.ok){Swal.fire({text:n.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:"Record(s) deleted!.",icon:"success",buttonsStyling:!1,allowOutsideClick:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}}).then(function(){d.ajax.reload(),f.querySelectorAll('[type="checkbox"]')[0].checked=!1}).then(function(){g(),y()})}).catch(function(n){n&&Swal.fire({text:n,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})}else o.dismiss==="cancel"&&Swal.fire({text:"Selected record(s) not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})},g=()=>{const r=f.querySelectorAll('tbody [type="checkbox"]');let s=!1,o=0;r.forEach(e=>{e.checked&&(s=!0,o++)}),s?(h.innerHTML=o,b.classList.add("d-none"),p.classList.remove("d-none")):(b.classList.remove("d-none"),p.classList.add("d-none"))},O=function(){if(permissions.modReport==0)return;const r=document.getElementById("kt_modal_export");if(!r)return;const s=r.querySelector("#kt_modal_export_form"),o=new bootstrap.Modal(r);var e=FormValidation.formValidation(s,{fields:{format:{validators:{notEmpty:{message:"File format is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});const a=r.querySelector('[data-kt-modal-action="submit"]');a.addEventListener("click",function(n){n.preventDefault(),e&&e.validate().then(function(l){if(l=="Valid"){a.setAttribute("data-kt-indicator","on");var t=document.getElementById("export-format").value;a.setAttribute("data-kt-indicator","on"),a.disabled=!0,fetch(w+"?modAction=modReport&modID="+permissions.modID,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"}}).then(function(i){return i.json()}).then(function(i){if(!i.ok){a.removeAttribute("data-kt-indicator"),a.disabled=!1,Swal.fire({text:i.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}a.removeAttribute("data-kt-indicator"),a.disabled=!1,o.hide(),Swal.fire({text:"Data is ready to be exported!",icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, Export!",customClass:{confirmButton:"btn btn-primary"}}).then(function(c){t==="print"?d.button(".buttons-print").trigger():t==="excel"?d.button(".buttons-excel").trigger():t==="csv"?d.button(".buttons-csv").trigger():t==="pdf"&&d.button(".buttons-pdf").trigger()})}).catch(function(i){i&&(a.removeAttribute("data-kt-indicator"),a.disabled=!1,Swal.fire({text:i,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}))})}else Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})})},D=(r,s)=>{const o=document.getElementById(r),e=document.getElementById(s);o.addEventListener("change",a=>{a.target.checked?e.classList.remove("d-none"):e.classList.add("d-none")})},_=function(r){let s=1,o=moment().year();var e=moment([o,s-1]),a=moment();function n(l,t){$(r).html(l.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"))}$(r).daterangepicker({startDate:e,endDate:a,ranges:{Today:[moment(),moment()],Yesterday:[moment().subtract(1,"days"),moment().subtract(1,"days")],"Last 7 Days":[moment().subtract(6,"days"),moment()],"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")]}},n),n(e,a)};return{init:function(){f=document.getElementById("kt_table_common"),f&&permissions.modRead!=0&&(B(),T(),E(),y(),O(),D("date_checkbox","date_checkbox_form"),_("#filter_datepicker"))}}}();KTUtil.onDOMContentLoaded(function(){I.init()});
