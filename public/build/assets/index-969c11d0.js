var _=function(){var u,b,p,h,c;const S=APP_URL+"/api/students",x=APP_URL+"/api/students",w=APP_URL+"/api/students/update",k=APP_URL+"/api/students/delete",v=APP_URL+"/api/export",T=()=>{var r,i,e,o;const a=document.querySelector("#kt_modal_filter");var n=document.querySelector(".search-input"),s=document.querySelector('[data-kt-table-filter="search-loader"]');a&&(r=new bootstrap.Modal(a),i=$("#kt_modal_filter_form"),e=a.querySelector('[data-kt-table-filter="reload"]'),o=a.querySelector('[data-kt-table-filter="reset"]')),c=$(u).DataTable({info:!0,processing:!0,serverSide:!0,order:[],pageLength:50,columnDefs:[{orderable:!1,targets:[0]},{orderable:!1,targets:6,visible:permissions.modUpdate==1||permissions.modDelete==1}],ajax:{url:S,method:"GET",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"},error:function(t,l,d){Swal.fire({title:"Request Timeout",text:"Oops :( request timed out. This could be as a result of an internal server error or slow or no internet connection. In the meantime, you can check your internet connection, refresh the page or wait a few minutes. Please contact admin if it persists.",icon:"info",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})},data:function(t){return"modAction=modRead&modID="+permissions.modID+"&dt_start="+t.start+"&dt_length="+t.length+"&dt_draw="+t.draw+"&dt_search="+n.value+(i?"&"+i.serialize():"")},beforeSend:function(){e&&(e.setAttribute("data-kt-indicator","on"),e.disabled=!0),s&&(s.setAttribute("data-kt-indicator","on"),s.disabled=!0)},complete:function(){e&&(e.removeAttribute("data-kt-indicator"),e.disabled=!1,r.hide()),s&&(s.removeAttribute("data-kt-indicator","on"),s.disabled=!1)}},columns:[{className:"p-4",defaultContent:`<div class="form-check form-check-sm form-check-custom">
                                    <input class="form-check-input" type="checkbox" value="1" />
                                </div>`},{data:"studentId"},{data:null,render:function(t,l,d,f){return t.firstName+" "+t.otherNames+" "+t.lastName}},{data:"className"},{data:null,className:"text-center",render:function(t,l,d,f){let m="";return t.status=="ACTIVE"?m='<div class="bg-success fw-bolder p-2 text-white">Active</div>':t.status=="INACTIVE"&&(m='<div class="bg-warning fw-bolder p-2 text-white">Inactive</div>'),m}},{data:"dateCreated"},{data:null,className:"text-center text-nowrap",render:function(t,l,d,f){var m="";return permissions.modUpdate==1&&(m+=`<a href="${APP_URL}/student/${t.id}" class="text-info me-3">
                                            View
                                        </a>`),permissions.modUpdate==1&&(m+=`<span style="cursor:pointer" class="text-primary me-3" data-kt-table-filter="update_row">
                                        Edit
                                    </span>`),permissions.modDelete==1&&(m+=`<span style="cursor:pointer" class="text-danger me-3 delete-btn" data-action="delete" data-id="${t.id}" data-kt-table-filter="delete">
                                        Delete
                                    </span>`),m}}],buttons:[{extend:"print",exportOptions:{columns:[1,2,3,4,5]}},{extend:"copy",exportOptions:{columns:[1,2,3,4,5]}},{extend:"excel",exportOptions:{columns:[1,2,3,4,5]}},{extend:"csv",exportOptions:{columns:[1,2,3,4,5]}},{extend:"pdf",exportOptions:{columns:[1,2,3,4,5]}},{text:"Refresh",action:function(t,l,d,f){l.ajax.reload(!1,null)}}]}),c.on("draw",function(){y(),O(),E(),g()}),n&&n.addEventListener("keyup",function(){c.search(n.value).draw()}),i&&(e&&e.addEventListener("click",function(t){c.ajax.reload()}),o&&o.addEventListener("click",function(){const t=document.querySelector('[data-kt-table-filter="form"]');t.querySelectorAll("select").forEach(d=>{$(d).val("").trigger("change")}),t.reset(),c.ajax.reload()}))},B=async()=>{if(permissions.modCreate==0)return;const r=document.querySelector("#kt_modal_add_common");if(!r)return;const i=new bootstrap.Modal(r),e=r.querySelector("form");if(!e)return;const o=r.querySelector('[data-action="submit"]');if(!o)return;const a=e.querySelectorAll("select");o.addEventListener("click",async n=>{n.preventDefault(),o.setAttribute("data-kt-indicator","on"),o.disabled=!0;let s=new FormData(e);s.append("modAction","modCreate"),s.append("modID",permissions.modID);try{const t=await fetch(x,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:s}),{ok:l,msg:d}=await t.json();if(!l){Swal.fire({text:d,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}e.reset(),i.hide(),c.ajax.reload(),a.forEach(f=>$(f).val("").trigger("change")),Swal.fire({text:d,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}catch(t){Swal.fire({text:t.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{o.removeAttribute("data-kt-indicator"),o.disabled=!1}})},A=async()=>{if(permissions.modUpdate==0)return;const r=document.querySelector("#kt_modal_update_common");if(!r)return;const i=new bootstrap.Modal(r),e=r.querySelector("form");if(!e)return;const o=r.querySelector('[data-action="submit"]');if(!o)return;const a=e.querySelectorAll("select");o.addEventListener("click",async n=>{n.preventDefault(),o.setAttribute("data-kt-indicator","on"),o.disabled=!0;let s=new FormData(e);s.append("modAction","modUpdate"),s.append("modID",permissions.modID);try{const t=await fetch(w,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:s}),{ok:l,msg:d}=await t.json();if(!l){Swal.fire({text:d,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}e.reset(),i.hide(),c.ajax.reload(),a.forEach(f=>$(f).val("").trigger("change")),Swal.fire({text:d,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}catch(t){Swal.fire({text:t.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{o.removeAttribute("data-kt-indicator"),o.disabled=!1}})},E=()=>{if(permissions.modUpdate==0)return;u.querySelectorAll('[data-kt-table-filter="update_row"]').forEach(i=>{i.addEventListener("click",function(e){e.preventDefault();const o=c.row($(e.target.closest("tbody tr"))).data();$("#kt_modal_update_common").modal("show"),$("#update-code").val(o.id),$("#update-student-id").val(o.studentId),$("#update-first-name").val(o.firstName),$("#update-last-name").val(o.lastName),$("#update-other-name").val(o.otherNames),$("#update-class").val(o.classId).trigger("change"),$("#update-status").val(o.status).trigger("change")})})},C=function(){if(permissions.modReport==0)return;const r=document.getElementById("kt_modal_export");if(!r)return;const i=r.querySelector("#kt_modal_export_form"),e=new bootstrap.Modal(r);var o=FormValidation.formValidation(i,{fields:{format:{validators:{notEmpty:{message:"File format is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});const a=r.querySelector('[data-kt-modal-action="submit"]');a.addEventListener("click",function(n){n.preventDefault(),o&&o.validate().then(function(s){if(s=="Valid"){a.setAttribute("data-kt-indicator","on");var t=document.getElementById("export-format").value;a.setAttribute("data-kt-indicator","on"),a.disabled=!0,fetch(v+"?modAction=modReport&modID="+permissions.modID,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"}}).then(function(l){return l.json()}).then(function(l){if(!l.ok){a.removeAttribute("data-kt-indicator"),a.disabled=!1,Swal.fire({text:l.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}a.removeAttribute("data-kt-indicator"),a.disabled=!1,e.hide(),Swal.fire({text:"Data is ready to be exported!",icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, Export!",customClass:{confirmButton:"btn btn-primary"}}).then(function(d){t==="print"?c.button(".buttons-print").trigger():t==="excel"?c.button(".buttons-excel").trigger():t==="csv"?c.button(".buttons-csv").trigger():t==="pdf"&&c.button(".buttons-pdf").trigger()})}).catch(function(l){l&&(a.removeAttribute("data-kt-indicator"),a.disabled=!1,Swal.fire({text:l,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}))})}else Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})})},O=async()=>{if(permissions.modDelete==0)return;u.querySelectorAll('[data-action="delete"]').forEach(i=>{i.addEventListener("click",async e=>{e.preventDefault();let o=JSON.stringify([e.currentTarget.getAttribute("data-id")]);Swal.fire({title:"Are you sure?",text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(async a=>{if(a.value){Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1});try{const n=await fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+o,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}),{ok:s,msg:t}=await n.json();if(!s){Swal.fire({text:t,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:t,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(l=>{c.ajax.reload()})}catch(n){Swal.fire({text:n.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{}}else a.dismiss==="cancel"&&Swal.fire({text:"Record was not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})})},y=()=>{if(permissions.modDelete==0)return;const r=u.querySelectorAll('[type="checkbox"]');b=document.querySelector('[data-kt-table-toolbar="base"]'),p=document.querySelector('[data-kt-table-toolbar="selected"]'),h=document.querySelector('[data-kt-table-select="selected_count"]');const i=document.querySelector('[data-kt-table-select="delete_selected"]');r.forEach(e=>{e.addEventListener("click",function(){setTimeout(function(){g()},50)})}),i.addEventListener("click",function(){Swal.fire({text:"Are you sure you want to delete selected record(s)?",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(e){if(e.value){var o=[];r.forEach(n=>{var t=n.closest("tr").querySelector(".delete-btn");t&&n.checked&&o.push(t.getAttribute("data-id"))});var a=JSON.stringify(o);Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),fetch(k+"?modAction=modDelete&modID="+permissions.modID+"&selected="+a,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(n){return n.json()}).then(function(n){if(!n.ok){Swal.fire({text:n.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:"Record(s) deleted!.",icon:"success",buttonsStyling:!1,allowOutsideClick:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}}).then(function(){c.ajax.reload(),u.querySelectorAll('[type="checkbox"]')[0].checked=!1}).then(function(){g(),y()})}).catch(function(n){n&&Swal.fire({text:n,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})}else e.dismiss==="cancel"&&Swal.fire({text:"Selected record(s) not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})},g=()=>{const r=u.querySelectorAll('tbody [type="checkbox"]');let i=!1,e=0;r.forEach(o=>{o.checked&&(i=!0,e++)}),i?(h.innerHTML=e,b&&b.classList.add("d-none"),p&&p.classList.remove("d-none")):(b&&b.classList.remove("d-none"),p&&p.classList.add("d-none"))};return{init:function(){u=document.getElementById("kt_table_common"),u&&permissions.modRead!=0&&(T(),y(),C(),B(),A())}}}();KTUtil.onDOMContentLoaded(function(){_.init()});
