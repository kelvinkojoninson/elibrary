var I=function(){var m,b,p,g,u;const w=APP_URL+"/api/roles",T=APP_URL+"/api/roles",q=APP_URL+"/api/roles/update",x=APP_URL+"/api/roles/delete",E=APP_URL+"/api/export",B=()=>{var a,s,o,n,r=document.querySelector(".search-input");const e=document.querySelector("#kt_modal_filter");e&&(a=new bootstrap.Modal(e),s=$("#kt_modal_filter_form"),o=e.querySelector('[data-kt-table-filter="reload"]'),n=e.querySelector('[data-kt-table-filter="reset"]')),u=$(m).DataTable({info:!0,processing:!1,serverSide:!1,order:[],pageLength:20,columnDefs:[{orderable:!1,targets:0},{orderable:!1,targets:5,visible:permissions.modUpdate==1||permissions.modDelete==1}],ajax:{url:w,method:"GET",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"},error:function(t,c,i){Swal.fire({title:"Request Timeout",text:"Oops :( request timed out. This could be as a result of an internal server error or slow or no internet connection. In the meantime, you can check your internet connection, refresh the page or wait a few minutes. Please contact admin if it persists.",icon:"info",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})},data:function(t){return"modAction=modRead&modID="+permissions.modID+"&dt_start="+t.start+"&dt_length="+t.length+"&dt_draw="+t.draw+"&dt_search="+r.value+(s?"&"+s.serialize():"")},beforeSend:function(){o&&(o.setAttribute("data-kt-indicator","on"),o.disabled=!0)},complete:function(){o&&(o.removeAttribute("data-kt-indicator"),o.disabled=!1,a.hide())}},columns:[{className:"p-4",defaultContent:`<div class="form-check form-check-sm form-check-custom">
                                        <input class="form-check-input" type="checkbox" value="1" />
                                    </div>`},{data:null,render:function(t,c,i,d){return`<span class="text-gray-800">${t.title}</span>`}},{data:"status",className:"text-center",render:function(t,c,i,d){return t=="ACTIVE"?'<div class="bg-success">Active</div>':'<div class="bg-danger text-white">Inactive</div>'}},{data:"users",className:"text-center"},{data:"dateCreated"},{data:null,className:"text-center",render:function(t,c,i,d){var l="";return permissions.modUpdate==1&&(l+=`<span style="cursor:pointer" class="text-primary me-3" data-kt-table-filter="update_row">
                                            Edit
                                        </span>`),permissions.modDelete==1&&(l+=`<span style="cursor:pointer" class="text-danger me-3 delete-btn" data-action="delete" data-id="${t.id}" data-kt-table-filter="delete">
                                            Delete
                                        </span>`),l}}],buttons:[{extend:"print",exportOptions:{columns:[1,2,3,4]}},{extend:"copy",exportOptions:{columns:[1,2,3,4]}},{extend:"excel",exportOptions:{columns:[1,2,3,4]}},{extend:"csv",exportOptions:{columns:[1,2,3,4]}},{extend:"pdf",exportOptions:{columns:[1,2,3,4]}},{text:"Refresh",action:function(t,c,i,d){c.ajax.reload(!1,null)}}]}),u.on("draw",function(){y(),D(),O(),h()}),r&&r.addEventListener("keyup",function(t){u.search(r.value).draw()}),s&&(o&&o.addEventListener("click",function(t){u.ajax.reload()}),n&&n.addEventListener("click",function(){const t=document.querySelector('[data-kt-table-filter="form"]');t.querySelectorAll("select").forEach(i=>{$(i).val("").trigger("change")}),t.reset(),u.ajax.reload()}))},C=async()=>{if(permissions.modCreate==0)return;const a=document.querySelector("#kt_modal_add_common");if(!a)return;const s=new bootstrap.Modal(a),o=a.querySelector("form");if(!o)return;const n=a.querySelector('[data-action="submit"]');if(!n)return;const r=o.querySelectorAll("select");n.addEventListener("click",async e=>{e.preventDefault(),n.setAttribute("data-kt-indicator","on"),n.disabled=!0;let t=new FormData(o);t.append("modAction","modCreate"),t.append("modID",permissions.modID);const c=o.querySelector("#kt_table_add");if(c){const d=c.querySelectorAll('[data-kt-row="permission-item"]');var i=[];d.forEach(l=>{i.push({modID:l.getAttribute("data-kt-id"),modRead:l.querySelector('[name="modRead"]').checked?1:0,modCreate:l.querySelector('[name="modCreate"]').checked?1:0,modUpdate:l.querySelector('[name="modUpdate"]').checked?1:0,modDelete:l.querySelector('[name="modDelete"]').checked?1:0,modReport:l.querySelector('[name="modReport"]').checked?1:0})}),t.append("permissions",JSON.stringify(i))}try{const d=await fetch(T,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:t}),{ok:l,msg:f}=await d.json();if(!l){Swal.fire({text:f,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:f,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(k=>{k.isConfirmed&&(o.reset(),s.hide(),u.ajax.reload(),r.forEach(S=>$(S).val("").trigger("change")))})}catch(d){Swal.fire({text:d.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{n.removeAttribute("data-kt-indicator"),n.disabled=!1}})},_=async()=>{if(permissions.modUpdate==0)return;const a=document.querySelector("#kt_modal_update_common");if(!a)return;const s=new bootstrap.Modal(a),o=a.querySelector("form");if(!o)return;const n=a.querySelector('[data-action="submit"]');if(!n)return;const r=o.querySelectorAll("select");n.addEventListener("click",async e=>{e.preventDefault(),n.setAttribute("data-kt-indicator","on"),n.disabled=!0;let t=new FormData(o);t.append("modAction","modUpdate"),t.append("modID",permissions.modID);const c=o.querySelector("#kt_table_update");if(c){const d=c.querySelectorAll('[data-kt-row="permission-item"]');var i=[];d.forEach(l=>{i.push({modID:l.getAttribute("data-kt-id"),modRead:l.querySelector('[name="modRead"]').checked?1:0,modCreate:l.querySelector('[name="modCreate"]').checked?1:0,modUpdate:l.querySelector('[name="modUpdate"]').checked?1:0,modDelete:l.querySelector('[name="modDelete"]').checked?1:0,modReport:l.querySelector('[name="modReport"]').checked?1:0})}),t.append("permissions",JSON.stringify(i))}try{const d=await fetch(q,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:t}),{ok:l,msg:f}=await d.json();if(!l){Swal.fire({text:f,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:f,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(k=>{k.isConfirmed&&(o.reset(),s.hide(),u.ajax.reload(),r.forEach(S=>$(S).val("").trigger("change")))})}catch(d){Swal.fire({text:d.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{n.removeAttribute("data-kt-indicator"),n.disabled=!1}})},O=()=>{if(permissions.modUpdate==0)return;m.querySelectorAll('[data-kt-table-filter="update_row"]').forEach(s=>{s.addEventListener("click",function(o){o.preventDefault();const n=u.row($(o.target.closest("tbody tr"))).data();$("#kt_modal_update_common").modal("show"),$("#update-code").val(n.id),$("#update-title").val(n.title),$("#update-status").val(n.status).trigger("change"),document.querySelector("#kt_table_update").querySelectorAll('[data-kt-row="permission-item"]').forEach(e=>{n.permissions.forEach(t=>{t.modID==e.getAttribute("data-kt-id")&&(t.modRead==1?e.querySelector('[name="modRead"]').checked=!0:e.querySelector('[name="modRead"]').checked=!1,t.modCreate==1?e.querySelector('[name="modCreate"]').checked=!0:e.querySelector('[name="modCreate"]').checked=!1,t.modUpdate==1?e.querySelector('[name="modUpdate"]').checked=!0:e.querySelector('[name="modUpdate"]').checked=!1,t.modDelete==1?e.querySelector('[name="modDelete"]').checked=!0:e.querySelector('[name="modDelete"]').checked=!1,t.modReport==1?e.querySelector('[name="modReport"]').checked=!0:e.querySelector('[name="modReport"]').checked=!1)})})})})},D=async()=>{if(permissions.modDelete==0)return;m.querySelectorAll('[data-action="delete"]').forEach(s=>{s.addEventListener("click",async o=>{o.preventDefault();let n=JSON.stringify([o.currentTarget.getAttribute("data-id")]);Swal.fire({title:"Are you sure?",text:"Are you sure you want to delete selected record(s)? All users with deleted roles will no longer have access to the system.",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(async r=>{if(r.value){Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1});try{const e=await fetch(x+"?modAction=modDelete&modID="+permissions.modID+"&selected="+n,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}),{ok:t,msg:c}=await e.json();if(!t){Swal.fire({text:c,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:c,icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}).then(i=>{u.ajax.reload()})}catch(e){Swal.fire({text:e.message,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})}finally{}}else r.dismiss==="cancel"&&Swal.fire({text:"Record was not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})})},y=()=>{if(permissions.modDelete==0)return;const a=m.querySelectorAll('[type="checkbox"]');b=document.querySelector('[data-kt-table-toolbar="base"]'),p=document.querySelector('[data-kt-table-toolbar="selected"]'),g=document.querySelector('[data-kt-table-select="selected_count"]');const s=document.querySelector('[data-kt-table-select="delete_selected"]');a.forEach(o=>{o.addEventListener("click",function(){setTimeout(function(){h()},50)})}),s.addEventListener("click",function(){Swal.fire({text:"Are you sure you want to delete selected record(s)? All users with deleted roles will no longer have access to the system.",icon:"warning",showCancelButton:!0,buttonsStyling:!1,confirmButtonText:"Yes, delete!",cancelButtonText:"No, cancel",customClass:{confirmButton:"btn fw-bold btn-danger",cancelButton:"btn fw-bold btn-active-light-primary"}}).then(function(o){if(o.value){var n=[];a.forEach(e=>{var c=e.closest("tr").querySelector(".delete-btn");c&&e.checked&&n.push(c.getAttribute("data-id"))});var r=JSON.stringify(n);Swal.fire({text:"Deleting record(s)...",showConfirmButton:!1,allowEscapeKey:!1,allowOutsideClick:!1}),fetch(x+"?modAction=modDelete&modID="+permissions.modID+"&selected="+r,{method:"DELETE",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}}).then(function(e){return e.json()}).then(function(e){if(!e.ok){Swal.fire({text:e.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}Swal.fire({text:"Record(s) deleted!.",icon:"success",buttonsStyling:!1,allowOutsideClick:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}}).then(function(){u.ajax.reload(),m.querySelectorAll('[type="checkbox"]')[0].checked=!1}).then(function(){h(),y()})}).catch(function(e){e&&Swal.fire({text:e,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})}else o.dismiss==="cancel"&&Swal.fire({text:"Selected record(s) not deleted.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn fw-bold btn-primary"}})})})},h=()=>{const a=m.querySelectorAll('tbody [type="checkbox"]');let s=!1,o=0;a.forEach(n=>{n.checked&&(s=!0,o++)}),s?(g.innerHTML=o,b.classList.add("d-none"),p.classList.remove("d-none")):(b.classList.remove("d-none"),p.classList.add("d-none"))},v=a=>{const s=document.querySelector(a);s.querySelectorAll("input[kt-select-mod]").forEach(n=>{n.addEventListener("change",()=>{const r=n.getAttribute("kt-select-mod");s.querySelectorAll(`input[child-mod="${r}"]`).forEach(t=>{t.checked=n.checked})})}),s.addEventListener("change",n=>{const r=n.target;if(r.getAttribute("kt-select-mod")){const e=r.getAttribute("kt-select-mod"),t=s.querySelectorAll(`input[child-mod="${e}"]`);r.checked||t.forEach(c=>{c.checked=!1})}})},A=a=>{const s=document.querySelector(a),o=s.querySelector(".kt_roles_select_all"),n=s.querySelectorAll('[type="checkbox"]');o.addEventListener("change",r=>{n.forEach(e=>{e.checked=r.target.checked})})},R=function(){if(permissions.modReport==0)return;const a=document.getElementById("kt_modal_export");if(!a)return;const s=a.querySelector("#kt_modal_export_form"),o=new bootstrap.Modal(a);var n=FormValidation.formValidation(s,{fields:{format:{validators:{notEmpty:{message:"File format is required"}}}},plugins:{trigger:new FormValidation.plugins.Trigger,bootstrap:new FormValidation.plugins.Bootstrap5({rowSelector:".fv-row",eleInvalidClass:"",eleValidClass:""})}});const r=a.querySelector('[data-kt-modal-action="submit"]');r.addEventListener("click",function(e){e.preventDefault(),n&&n.validate().then(function(t){if(t=="Valid"){r.setAttribute("data-kt-indicator","on");var c=document.getElementById("export-format").value;r.setAttribute("data-kt-indicator","on"),r.disabled=!0,fetch(E+"?modAction=modReport&modID="+permissions.modID,{method:"POST",headers:{Authorization:`Bearer ${apiToken}`,"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content"),"Content-Type":"application/json"}}).then(function(i){return i.json()}).then(function(i){if(!i.ok){r.removeAttribute("data-kt-indicator"),r.disabled=!1,Swal.fire({text:i.msg,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}});return}r.removeAttribute("data-kt-indicator"),r.disabled=!1,o.hide(),Swal.fire({text:"Data is ready to be exported!",icon:"success",allowOutsideClick:!1,buttonsStyling:!1,confirmButtonText:"Ok, Export!",customClass:{confirmButton:"btn btn-primary"}}).then(function(d){c==="print"?u.button(".buttons-print").trigger():c==="excel"?u.button(".buttons-excel").trigger():c==="csv"?u.button(".buttons-csv").trigger():c==="pdf"&&u.button(".buttons-pdf").trigger()})}).catch(function(i){i&&(r.removeAttribute("data-kt-indicator"),r.disabled=!1,Swal.fire({text:i,icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}}))})}else Swal.fire({text:"Sorry, looks like there are some errors detected, please try again.",icon:"error",buttonsStyling:!1,confirmButtonText:"Ok, got it!",customClass:{confirmButton:"btn btn-primary"}})})})};return{init:function(){m=document.getElementById("kt_table_common"),m&&permissions.modRead!=0&&(B(),C(),_(),y(),R(),v("#kt_table_add"),v("#kt_table_update"),A("#kt_table_add"),A("#kt_table_update"))}}}();KTUtil.onDOMContentLoaded(function(){I.init()});
